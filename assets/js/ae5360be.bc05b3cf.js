"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[983],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>k});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),l=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),u=l(n),h=i,k=u["".concat(s,".").concat(h)]||u[h]||m[h]||r;return n?a.createElement(k,o(o({ref:t},p),{},{components:n})):a.createElement(k,o({ref:t},p))}));function k(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=h;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c[u]="string"==typeof e?e:i,o[1]=c;for(var l=2;l<r;l++)o[l]=n[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},1180:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>c,toc:()=>l});var a=n(7462),i=(n(7294),n(3905));const r={sidebar_position:5},o="Docker Configuration",c={unversionedId:"guide-to-dynamic-builds/docker-configuration",id:"guide-to-dynamic-builds/docker-configuration",title:"Docker Configuration",description:"Jobs can run either in a Docker container ('docker' jobs) or natively on the machine where the runner or bb",source:"@site/docs/guide-to-dynamic-builds/docker-configuration.md",sourceDirName:"guide-to-dynamic-builds",slug:"/guide-to-dynamic-builds/docker-configuration",permalink:"/docs/guide-to-dynamic-builds/docker-configuration",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Steps",permalink:"/docs/guide-to-dynamic-builds/steps"},next:{title:"Callbacks and Waiting",permalink:"/docs/guide-to-dynamic-builds/callbacks-and-waits"}},s={},l=[{value:"Docker Configuration Object",id:"docker-configuration-object",level:2},{value:"Authentication for Docker Registries",id:"authentication-for-docker-registries",level:2},{value:"Basic Authentication",id:"basic-authentication",level:3},{value:"Amazon ECR Authentication",id:"amazon-ecr-authentication",level:3}],p={toc:l},u="wrapper";function m(e){let{components:t,...n}=e;return(0,i.kt)(u,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"docker-configuration"},"Docker Configuration"),(0,i.kt)("p",null,"Jobs can run either in a Docker container ('docker' jobs) or natively on the machine where the runner or ",(0,i.kt)("em",{parentName:"p"},"bb"),"\nexecutable is running ('native' jobs, also known as 'exec' jobs)."),(0,i.kt)("p",null,"For Docker jobs, configuration options can be specified on a per-job basis by defining Docker Configurations."),(0,i.kt)("h1",{id:"defining-a-docker-configuration"},"Defining a Docker Configuration"),(0,i.kt)("p",null,"The workflow handler function defines a Docker Configuration by calling ",(0,i.kt)("inlineCode",{parentName:"p"},"NewDocker()")," to create a\n",(0,i.kt)("em",{parentName:"p"},"Docker Config object"),", then calling the Job's ",(0,i.kt)("inlineCode",{parentName:"p"},"Docker()")," method to use the config for the Job.\nThe same Docker Config object can be used for more than one job.\nProperties are set on the Docker Config by calling methods on the object."),(0,i.kt)("p",null,"Here's an example of a docker Job with an image and pull strategy defined (some details\nreplaced with ",(0,i.kt)("inlineCode",{parentName:"p"},"....")," for brevity):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'    w.Job(bb.NewJob().\n        Name("a-docker-based-job").\n        Docker(bb.NewDocker().\n            Image("node:18.4.0-alpine").\n            Pull(bb.DockerPullIfNotExists))).\n        Step(....))\n')),(0,i.kt)("h2",{id:"docker-configuration-object"},"Docker Configuration Object"),(0,i.kt)("p",null,"The following methods are available to set properties on a Docker Configuration:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Image")," (mandatory): specifies the name of the Docker image to use when running this Job.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Shell")," (optional): specifies the shell to use to run commands inside the docker container.\nDefault is ",(0,i.kt)("inlineCode",{parentName:"p"},"/bin/sh")," for Unix-based containers, or ",(0,i.kt)("inlineCode",{parentName:"p"},"cmd.exe")," for Windows-based containers.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Pull")," (optional): specifies when to pull the Docker image from the Registry. Constants are provided for\nthese options:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"DockerPullNever"),": never pull the image; it must already exist in the cache")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"DockerPullAlways"),": always pull the image, just before the Job is run each time")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"DockerPullIfNotExists"),": pull the image only if there is no version in the cache")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"DockerPullDefault"),": the default behaviour if no Pull() option specified. This is equivalent to\n",(0,i.kt)("inlineCode",{parentName:"p"},"DockerPullAlways")," if the image tag is 'latest', or ",(0,i.kt)("inlineCode",{parentName:"p"},"DockerPullIfNotExists")," if the image tag refers\nto a specific version.")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"BasicAuth")," (optional): configures Basic Authentication credentials for the Docker registry, to use when\nfetching the Docker image. Takes a BasicAuth object to specify the username and password\nfor authentication; see ",(0,i.kt)("a",{parentName:"p",href:"#authentication-for-docker-registries"},"Authentication for Docker Registries")," for details.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"AWSAuth")," (optional): configures AWS Authentication credentials for Amazon ECR, to use when fetching the Docker\nimage. Takes an AWSAuth object to specify the details for authentication;\nsee ",(0,i.kt)("a",{parentName:"p",href:"#authentication-for-docker-registries"},"Authentication for Docker Registries")," for details."))),(0,i.kt)("h2",{id:"authentication-for-docker-registries"},"Authentication for Docker Registries"),(0,i.kt)("p",null,"When pulling a Docker image to be used to run a Job or Service, authentication may be required if the Docker\nimage is not public. BuildBeaver supports Authentication via Basic Auth (for Docker Registry) or to Amazon Elastic\nContainer Registry (ECR)."),(0,i.kt)("h3",{id:"basic-authentication"},"Basic Authentication"),(0,i.kt)("p",null,"Configure Basic Authentication by calling ",(0,i.kt)("inlineCode",{parentName:"p"},"NewBasicAuth()")," to create a ",(0,i.kt)("em",{parentName:"p"},"Basic Auth object"),", then calling the\nDocker Config object's ",(0,i.kt)("inlineCode",{parentName:"p"},"BasicAuth()")," method. The following methods are available to set properties on a\nBasic Auth object:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Username")," (optional): specifies the username to use when authenticating, as a string literal.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"UsernameFromSecret")," (optional): specifies the name of a ",(0,i.kt)("a",{parentName:"p",href:"jobs#secrets"},"Secret")," containing the username\nto use when authenticating. Either Username() or UsernameFromSecret() must be called.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"PasswordFromSecret")," (mandatory): specifies the name of a ",(0,i.kt)("a",{parentName:"p",href:"jobs#secrets"},"Secret")," containing the password\nto use when authenticating. The password can't be provided as a string literal; it must be provided in a secret."))),(0,i.kt)("h3",{id:"amazon-ecr-authentication"},"Amazon ECR Authentication"),(0,i.kt)("p",null,"Configure Authentication to Amazon ECR by calling ",(0,i.kt)("inlineCode",{parentName:"p"},"NewAWSAuth()")," to create an ",(0,i.kt)("em",{parentName:"p"},"AWS Auth object"),", then calling the\nDocker Config object's ",(0,i.kt)("inlineCode",{parentName:"p"},"AWSAuth()")," method. The following methods are available to set properties on an\nAWS Auth object:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Region")," (optional): specifies the region (string) to use when authenticating to Amazon ECR.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"AccessKeyID")," (optional): specifies the Access Key ID to use when authenticating, as a string literal.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"AccessKeyIDFromSecret")," (optional): specifies the name of a ",(0,i.kt)("a",{parentName:"p",href:"jobs#secrets"},"Secret")," containing the\nAccess Key ID to use when authenticating. Either AccessKeyID() or AccessKeyIDFromSecret() must be called.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"SecretAccessKeyFromSecret")," (mandatory): specifies the name of a ",(0,i.kt)("a",{parentName:"p",href:"jobs#secrets"},"Secret")," containing the\nSecret Access Key to use when authenticating. This value can't be provided as a string literal;\nit must be provided in a secret."))))}m.isMDXComponent=!0}}]);